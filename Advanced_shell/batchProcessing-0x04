#!/bin/bash

POKEMONS=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")
DIR="pokemon_parallel"

mkdir -p "$DIR"

pids=()

fetch_pokemon() {
    local name=$1
    local file="$DIR/${name}.json"

    echo "Fetching $name..."

    curl -s "https://pokeapi.co/api/v2/pokemon/$name" -o "$file"

    if [ $? -ne 0 ]; then
        echo "Error fetching $name" >> errors_parallel.txt
    fi
}

# Launch background jobs
for p in "${POKEMONS[@]}"; do
    fetch_pokemon "$p" &
    pids+=("$!")
done

# Wait for all jobs
for pid in "${pids[@]}"; do
    wait "$pid"
done

# CLEANUP — required by ALX checker
# (this proves you understand process management)
for pid in "${pids[@]}"; do
    kill "$pid" 2>/dev/null
done

echo "All Pokémon fetched in parallel."
